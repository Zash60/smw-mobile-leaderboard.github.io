<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMW Speedrun Mobile</title>
    <style>
        /* CSS Básico para a aplicação */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #18181b;
            color: #e4e4e7;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #27272a;
            padding: 20px;
            border-radius: 8px;
        }
        header h1 {
            text-align: center;
            color: #a78bfa;
            margin-top: 0;
        }
        nav {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #3f3f46;
            padding-bottom: 10px;
        }
        nav button {
            background: none;
            border: none;
            color: #a1a1aa;
            font-size: 1.1em;
            padding: 10px 20px;
            cursor: pointer;
            transition: color 0.2s, border-bottom 0.2s;
            border-bottom: 2px solid transparent;
        }
        nav button.active {
            color: #e4e4e7;
            border-bottom: 2px solid #a78bfa;
        }
        .content-section {
            display: none; /* Escondido por padrão */
        }
        .content-section.active {
            display: block; /* Mostra a aba ativa */
        }
        .category {
            background-color: #3f3f46;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .category h2 {
            margin-top: 0;
            color: #c4b5fd;
        }
        .category ul {
            list-style-type: none;
            padding-left: 10px;
        }
        .category li {
            padding: 5px 0;
        }
        #loading {
            text-align: center;
            font-size: 1.2em;
            padding: 40px;
        }
        /* Estilos para formulários */
        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        input {
            padding: 10px;
            background-color: #3f3f46;
            border: 1px solid #52525b;
            color: #e4e4e7;
            border-radius: 4px;
        }
        .submit-btn, .logout-btn {
            padding: 10px;
            background-color: #7c3aed;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .submit-btn:hover {
            background-color: #8b5cf6;
        }
        #mod-status {
            text-align: center;
        }
        #submit-run-btn-container {
            text-align: center;
            margin-top: 30px;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>SMW Speedrun Mobile</h1>
        </header>

        <nav>
            <button id="home-tab-btn" class="active">Home</button>
            <button id="mod-tab-btn">Mod</button>
        </nav>

        <main>
            <!-- Conteúdo da Aba HOME -->
            <section id="home-content" class="content-section active">
                <div id="loading">Carregando categorias...</div>
                <div id="categories-container"></div>
            </section>

            <!-- Conteúdo da Aba MOD -->
            <section id="mod-content" class="content-section">
                <div id="mod-status">
                    <!-- O status de login/logout aparecerá aqui -->
                    <div id="login-form-container">
                        <h3>Login de Moderador</h3>
                        <form id="login-form">
                            <input type="email" id="email" placeholder="Email" required>
                            <input type="password" id="password" placeholder="Senha" required>
                            <button type="submit" class="submit-btn">Entrar</button>
                        </form>
                        <p id="login-error" style="color: #f87171;"></p>
                    </div>

                    <div id="mod-area" style="display: none;">
                        <p>Bem-vindo, <span id="user-email"></span>!</p>
                        <p>Esta é a área restrita para moderadores.</p>
                        <button id="logout-btn" class="logout-btn">Sair</button>
                    </div>
                </div>
            </section>
        </main>
        
        <div id="submit-run-btn-container">
             <button class="submit-btn" onclick="alert('Funcionalidade de submissão de run a ser implementada!')">Submit Run</button>
        </div>

    </div>

    <!-- Script do Firebase -->
    <script type="module">
      // Importações do Firebase SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { 
          getAuth, 
          onAuthStateChanged, 
          signInWithEmailAndPassword, 
          signOut 
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
      // A importação do Firestore seria aqui, se fôssemos usar para enviar dados
      // import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      // Sua configuração do Firebase que você forneceu
      const firebaseConfig = {
        apiKey: "AIzaSyDZmCb9AJs1uNnGkww1qR1EM0JAzag0EAo", // Use a sua chave de API
        authDomain: "smw-mobile-speedrun.firebaseapp.com",
        projectId: "smw-mobile-speedrun",
        storageBucket: "smw-mobile-speedrun.firebasestorage.app",
        messagingSenderId: "463967608988",
        appId: "1:463967608988:web:46c33614c12ad38895cd59"
      };

      // Inicializa o Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      // const db = getFirestore(app); // Inicializaria o Firestore aqui

      // --- LÓGICA DE NAVEGAÇÃO ENTRE ABAS ---
      const homeTabBtn = document.getElementById('home-tab-btn');
      const modTabBtn = document.getElementById('mod-tab-btn');
      const homeContent = document.getElementById('home-content');
      const modContent = document.getElementById('mod-content');

      function showTab(tabName) {
          homeContent.classList.remove('active');
          modContent.classList.remove('active');
          homeTabBtn.classList.remove('active');
          modTabBtn.classList.remove('active');

          if (tabName === 'home') {
              homeContent.classList.add('active');
              homeTabBtn.classList.add('active');
          } else if (tabName === 'mod') {
              modContent.classList.add('active');
              modTabBtn.classList.add('active');
          }
      }

      homeTabBtn.addEventListener('click', () => showTab('home'));
      modTabBtn.addEventListener('click', () => showTab('mod'));

      // --- LÓGICA DA API SPEEDRUN.COM ---
      const gameId = 'o1y9wo6q'; // ID de Super Mario World no speedrun.com
      const categoriesContainer = document.getElementById('categories-container');
      const loadingDiv = document.getElementById('loading');

      async function fetchCategories() {
          try {
              const response = await fetch(`https://www.speedrun.com/api/v1/games/${gameId}/categories`);
              if (!response.ok) throw new Error('Falha ao buscar categorias');
              const data = await response.json();
              
              loadingDiv.style.display = 'none';

              // Filtra para mostrar apenas categorias "Per-game"
              const perGameCategories = data.data.filter(cat => cat.type === 'per-game');

              for (const category of perGameCategories) {
                  const categoryDiv = document.createElement('div');
                  categoryDiv.className = 'category';
                  
                  const categoryTitle = document.createElement('h2');
                  categoryTitle.textContent = category.name;
                  categoryDiv.appendChild(categoryTitle);

                  // A API de categorias pode ter subcategorias na forma de "variables"
                  // Vamos buscar as variáveis para cada categoria
                  const variablesLink = category.links.find(link => link.rel === 'variables');
                  if (variablesLink) {
                      await fetchAndDisplayVariables(variablesLink.uri, categoryDiv);
                  }

                  categoriesContainer.appendChild(categoryDiv);
              }
          } catch (error) {
              loadingDiv.textContent = `Erro: ${error.message}`;
              console.error('Erro ao buscar dados da API:', error);
          }
      }

      async function fetchAndDisplayVariables(uri, parentElement) {
          try {
              const response = await fetch(uri);
              if (!response.ok) return; // Algumas categorias podem não ter variáveis
              const data = await response.json();
              
              const subcategory = data.data.find(v => v['is-subcategory']);
              if (subcategory) {
                  const ul = document.createElement('ul');
                  for (const valueId in subcategory.values.values) {
                      const subcatName = subcategory.values.values[valueId].label;
                      const li = document.createElement('li');
                      li.textContent = subcatName;
                      ul.appendChild(li);
                  }
                  parentElement.appendChild(ul);
              }
          } catch (error) {
              console.error('Erro ao buscar subcategorias:', error);
          }
      }

      // --- LÓGICA DE AUTENTICAÇÃO FIREBASE ---
      const loginFormContainer = document.getElementById('login-form-container');
      const modArea = document.getElementById('mod-area');
      const userEmailSpan = document.getElementById('user-email');
      const loginForm = document.getElementById('login-form');
      const logoutBtn = document.getElementById('logout-btn');
      const loginErrorP = document.getElementById('login-error');

      // Observa mudanças no estado de login do usuário
      onAuthStateChanged(auth, (user) => {
          if (user) {
              // Usuário está logado
              loginFormContainer.style.display = 'none';
              modArea.style.display = 'block';
              userEmailSpan.textContent = user.email;
          } else {
              // Usuário está deslogado
              loginFormContainer.style.display = 'block';
              modArea.style.display = 'none';
              userEmailSpan.textContent = '';
          }
      });
      
      // Evento de submit do formulário de login
      loginForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;
          loginErrorP.textContent = '';

          try {
              await signInWithEmailAndPassword(auth, email, password);
              // O onAuthStateChanged vai cuidar de atualizar a UI
          } catch (error) {
              console.error('Erro no login:', error.message);
              loginErrorP.textContent = 'Email ou senha inválidos.';
          }
      });

      // Evento do botão de logout
      logoutBtn.addEventListener('click', async () => {
          try {
              await signOut(auth);
          } catch (error) {
              console.error('Erro no logout:', error);
          }
      });

      // --- INICIALIZAÇÃO DA PÁGINA ---
      document.addEventListener('DOMContentLoaded', () => {
          showTab('home'); // Mostra a aba Home por padrão
          fetchCategories(); // Busca as categorias da speedrun.com
      });

    </script>
</body>
</html>
